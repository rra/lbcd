#
# Makefile.in for lbcd
#

CC     = @CC@

DEFS   = @DEFS@
LIBS   = @LIBS@
CFLAGS = @CFLAGS@

srcdir = @srcdir@
VPATH  = @srcdir@

SHELL  = /bin/sh

HDRS   = config.h lbcd.h lbcdload.h protocol.h

SRCS   = lbcd.c server.c util.c \
	kernel.c get_user.c tmp_full.c weight.c load.c

OBJS   = $(SRCS:.c=.o)
LIBRARY= modules/liblbcd.a

all: lbcd

.c.o: $(HDRS) $*.c
	$(CC) -c -I. -I$(srcdir) $(DEFS) $(CFLAGS) $<

lbcd: $(OBJS) $(LIBRARY)
	$(CC) $(LDFLAGS) -o $@ $(OBJS) $(LIBRARY) $(LIBS)

$(LIBRARY):
	cd modules && ${MAKE}

clean:
	-rm -f *.o core lbcd
	cd modules && ${MAKE} $@

distclean: clean
	-rm -f Makefile config.log config.status config.cache config.h
	cd modules && ${MAKE} $@

#
# Dependencies
#
kernel.o: $(srcdir)/kernel.c \
	$(srcdir)/arch/aix.c $(srcdir)/arch/hpux10.c \
	$(srcdir)/arch/irix.c $(srcdir)/arch/linux.c \
	$(srcdir)/arch/osf.c $(srcdir)/arch/solaris.c
